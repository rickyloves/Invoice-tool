<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>发票组合工具（终极智能备注版）</title>
<style>
body{font-family:sans-serif;max-width:800px;margin:auto;padding:20px}
input,button,textarea{margin:5px 0;padding:8px;font-size:16px}
textarea{width:100%;height:220px}.record{border:1px solid #ccc;padding:10px;margin:10px 0}
</style>
</head>
<body>
<h2>发票组合工具（终极智能备注版）</h2>
<label>目标金额：</label><input id="target" type="number"><br>
<label>（可选）单张最大金额：</label><input id="maxAmount" type="number"><br>
<button onclick="findMatch()">查找组合</button>
<p id="status"></p><ul id="comboList"></ul>
<button onclick="confirmDelete()">确认删除</button>
<button onclick="resetDatabase()">重置数据库</button>
<h3>导出发票内容</h3>
<textarea id="exportText" readonly></textarea>
<button onclick="copyText()">复制导出内容</button>
<h3>删除记录（最多显示20条）</h3>
<div id="deletedRecords"></div>
<script>
const rawData = [{"订单号": "28463747194", "金额": 574}, {"订单号": "28963113210", "金额": 590}, {"订单号": "33897710458", "金额": 610}, {"订单号": "33898104698", "金额": 610}, {"订单号": "33899392762", "金额": 610}, {"订单号": "33899391994", "金额": 610}, {"订单号": "33898544954", "金额": 610}, {"订单号": "33898028090", "金额": 610}, {"订单号": "33788378426", "金额": 610}, {"订单号": "33512092090", "金额": 610}, {"订单号": "33494149754", "金额": 610}, {"订单号": "34090627066", "金额": 615}, {"订单号": "33223841274", "金额": 620}, {"订单号": "29054998138", "金额": 660}, {"订单号": "29054984250", "金额": 660}, {"订单号": "29018423802", "金额": 660}, {"订单号": "28694993082", "金额": 667}, {"订单号": "28693975354", "金额": 667}, {"订单号": "28770869434", "金额": 667}, {"订单号": "28955037946", "金额": 699}, {"订单号": "34193197178", "金额": 700}, {"订单号": "34193026810", "金额": 700}, {"订单号": "34157709114", "金额": 700}, {"订单号": "34156958074", "金额": 700}, {"订单号": "34018792442", "金额": 700}, {"订单号": "33898416890", "金额": 700}, {"订单号": "33898405562", "金额": 700}, {"订单号": "33887734138", "金额": 700}, {"订单号": "33888148602", "金额": 700}, {"订单号": "33887947002", "金额": 700}, {"订单号": "33800146554", "金额": 700}, {"订单号": "33617747514", "金额": 700}, {"订单号": "34549641210", "金额": 700}, {"订单号": "34466650362", "金额": 700}, {"订单号": "34466819706", "金额": 700}, {"订单号": "34465939322", "金额": 700}, {"订单号": "34466819834", "金额": 700}, {"订单号": "34444544826", "金额": 700}, {"订单号": "34445819258", "金额": 700}, {"订单号": "34439581882", "金额": 700}, {"订单号": "34428363770", "金额": 700}, {"订单号": "34249471674", "金额": 700}, {"订单号": "34249444026", "金额": 700}, {"订单号": "34456744250", "金额": 705}, {"订单号": "34456577402", "金额": 705}, {"订单号": "32949490810", "金额": 710}, {"订单号": "32871257786", "金额": 710}, {"订单号": "34092812282", "金额": 710}, {"订单号": "34092980346", "金额": 710}, {"订单号": "33158701626", "金额": 710}, {"订单号": "34553343034", "金额": 710}, {"订单号": "34551674298", "金额": 710}, {"订单号": "34456627898", "金额": 710}, {"订单号": "34456627770", "金额": 710}, {"订单号": "34446218746", "金额": 710}, {"订单号": "34446099642", "金额": 710}, {"订单号": "34446150074", "金额": 710}, {"订单号": "34446303930", "金额": 710}, {"订单号": "34446446202", "金额": 710}, {"订单号": "31965579130", "金额": 720}, {"订单号": "32764336634", "金额": 720}, {"订单号": "34158488506", "金额": 804}, {"订单号": "34092228090", "金额": 805}, {"订单号": "34092562490", "金额": 805}, {"订单号": "34455854010", "金额": 805}, {"订单号": "34216672570", "金额": 810}, {"订单号": "34216561274", "金额": 810}, {"订单号": "34216595706", "金额": 810}, {"订单号": "34204662458", "金额": 810}, {"订单号": "34204761914", "金额": 810}, {"订单号": "34204378746", "金额": 810}, {"订单号": "34204411130", "金额": 810}, {"订单号": "34194249082", "金额": 810}, {"订单号": "34180365562", "金额": 810}, {"订单号": "34092783674", "金额": 810}, {"订单号": "34092663418", "金额": 810}, {"订单号": "34092652026", "金额": 810}, {"订单号": "34092747194", "金额": 810}, {"订单号": "34092591738", "金额": 810}, {"订单号": "33998478266", "金额": 810}, {"订单号": "33897981882", "金额": 810}, {"订单号": "33898173754", "金额": 810}, {"订单号": "33898154490", "金额": 810}, {"订单号": "33898151098", "金额": 810}, {"订单号": "33897793338", "金额": 810}, {"订单号": "33887743930", "金额": 810}, {"订单号": "33801095610", "金额": 810}, {"订单号": "33757188474", "金额": 810}, {"订单号": "33403617466", "金额": 810}, {"订单号": "34550348346", "金额": 810}, {"订单号": "34550346682", "金额": 810}, {"订单号": "34466214266", "金额": 810}, {"订单号": "34455852858", "金额": 810}, {"订单号": "34456053626", "金额": 810}, {"订单号": "34445422202", "金额": 810}, {"订单号": "34445104058", "金额": 810}, {"订单号": "34445435706", "金额": 810}, {"订单号": "34445263162", "金额": 810}, {"订单号": "34438049786", "金额": 810}, {"订单号": "34429456122", "金额": 810}, {"订单号": "34429439994", "金额": 810}, {"订单号": "34429469434", "金额": 810}, {"订单号": "34429048506", "金额": 810}, {"订单号": "34249712250", "金额": 810}, {"订单号": "34249676922", "金额": 810}, {"订单号": "34248943930", "金额": 810}, {"订单号": "33109383994", "金额": 820}, {"订单号": "33032941818", "金额": 820}, {"订单号": "32937523770", "金额": 820}, {"订单号": "32896545978", "金额": 820}, {"订单号": "32898005178", "金额": 820}, {"订单号": "32897838394", "金额": 820}, {"订单号": "32883159610", "金额": 820}, {"订单号": "32883643770", "金额": 820}, {"订单号": "32870545594", "金额": 820}, {"订单号": "32870112954", "金额": 820}, {"订单号": "32870722298", "金额": 820}, {"订单号": "32817328698", "金额": 820}, {"订单号": "34216420474", "金额": 820}, {"订单号": "34092813306", "金额": 820}, {"订单号": "33223635962", "金额": 820}, {"订单号": "34554090042", "金额": 820}, {"订单号": "34553379322", "金额": 820}, {"订单号": "34553338682", "金额": 820}, {"订单号": "34552706362", "金额": 820}, {"订单号": "34446243834", "金额": 820}, {"订单号": "34446591802", "金额": 820}, {"订单号": "32650945978", "金额": 830}, {"订单号": "32650522682", "金额": 830}, {"订单号": "32537980986", "金额": 830}, {"订单号": "32518487418", "金额": 830}, {"订单号": "32378262074", "金额": 830}, {"订单号": "32378769338", "金额": 830}, {"订单号": "32376437370", "金额": 830}, {"订单号": "32363253690", "金额": 830}, {"订单号": "32363168762", "金额": 830}, {"订单号": "32363584826", "金额": 830}, {"订单号": "32130747514", "金额": 830}, {"订单号": "32107889722", "金额": 830}, {"订单号": "32108179386", "金额": 830}, {"订单号": "32107834042", "金额": 830}, {"订单号": "31999524986", "金额": 830}, {"订单号": "31498857786", "金额": 830}, {"订单号": "32772392954", "金额": 830}, {"订单号": "32691819962", "金额": 830}, {"订单号": "32691990842", "金额": 830}, {"订单号": "32692416250", "金额": 830}, {"订单号": "34204338810", "金额": 910}, {"订单号": "34181422074", "金额": 910}, {"订单号": "34092780090", "金额": 910}, {"订单号": "34092183482", "金额": 910}, {"订单号": "34019294010", "金额": 910}, {"订单号": "33898232314", "金额": 910}, {"订单号": "33772745722", "金额": 910}, {"订单号": "33750042874", "金额": 910}, {"订单号": "33635918074", "金额": 910}, {"订单号": "34455618362", "金额": 910}, {"订单号": "34429156602", "金额": 910}, {"订单号": "34265656954", "金额": 910}, {"订单号": "32772846266", "金额": 915}, {"订单号": "32951667066", "金额": 920}, {"订单号": "32937235706", "金额": 920}, {"订单号": "32938214906", "金额": 920}, {"订单号": "32870312058", "金额": 920}, {"订单号": "32870732986", "金额": 920}, {"订单号": "32650987834", "金额": 930}, {"订单号": "32537810490", "金额": 930}, {"订单号": "32453645626", "金额": 930}, {"订单号": "32451435066", "金额": 930}, {"订单号": "32378666746", "金额": 930}, {"订单号": "32290784698", "金额": 930}, {"订单号": "32205652026", "金额": 930}, {"订单号": "32205031290", "金额": 930}, {"订单号": "32196888570", "金额": 930}, {"订单号": "32114337082", "金额": 930}, {"订单号": "32114319546", "金额": 930}, {"订单号": "32108214970", "金额": 930}, {"订单号": "31998719866", "金额": 930}, {"订单号": "31911576570", "金额": 930}, {"订单号": "32772294394", "金额": 930}, {"订单号": "32764340602", "金额": 930}, {"订单号": "32763827322", "金额": 930}, {"订单号": "32762902138", "金额": 930}, {"订单号": "32698635514", "金额": 930}, {"订单号": "29020165050", "金额": 940}, {"订单号": "29234747258", "金额": 1060}, {"订单号": "29044835706", "金额": 1060}, {"订单号": "32943110522", "金额": 1133}, {"订单号": "32943676026", "金额": 1133}, {"订单号": "32943614202", "金额": 1133}, {"订单号": "32938318522", "金额": 1133}, {"订单号": "32103069882", "金额": 1140}, {"订单号": "32102900282", "金额": 1140}, {"订单号": "32102640442", "金额": 1140}, {"订单号": "32114585594", "金额": 1142}, {"订单号": "31991214202", "金额": 1142}, {"订单号": "31578495354", "金额": 1142}, {"订单号": "31487547706", "金额": 1142}, {"订单号": "32665415354", "金额": 1143}, {"订单号": "32537775546", "金额": 1143}, {"订单号": "32520286458", "金额": 1143}, {"订单号": "32771833402", "金额": 1143}, {"订单号": "28463413306", "金额": 1182}, {"订单号": "28699086586", "金额": 1190}, {"订单号": "28698767354", "金额": 1190}, {"订单号": "28462883962", "金额": 1192}, {"订单号": "28462899322", "金额": 1192}, {"订单号": "28719742010", "金额": 1208}, {"订单号": "28719669498", "金额": 1208}, {"订单号": "28719936378", "金额": 1208}, {"订单号": "32948910906", "金额": 1215}, {"订单号": "32857231610", "金额": 1220}, {"订单号": "32856506042", "金额": 1220}, {"订单号": "31914925498", "金额": 1223}, {"订单号": "32130316154", "金额": 1225}, {"订单号": "32114757370", "金额": 1225}, {"订单号": "32457440506", "金额": 1227}, {"订单号": "32642639930", "金额": 1230}, {"订单号": "32641660282", "金额": 1230}, {"订单号": "32640858554", "金额": 1230}, {"订单号": "32641344378", "金额": 1230}, {"订单号": "34180559418", "金额": 1230}, {"订单号": "34180056954", "金额": 1230}, {"订单号": "33764369978", "金额": 1230}, {"订单号": "33533313402", "金额": 1230}, {"订单号": "29053998650", "金额": 1240}, {"订单号": "33083459834", "金额": 1240}, {"订单号": "33381637818", "金额": 1240}, {"订单号": "33158688762", "金额": 1240}, {"订单号": "28474816762", "金额": 1250}, {"订单号": "34239401850", "金额": 1320}, {"订单号": "34223778618", "金额": 1320}, {"订单号": "34204742266", "金额": 1320}, {"订单号": "34204605754", "金额": 1320}, {"订单号": "34205011706", "金额": 1320}, {"订单号": "34178641530", "金额": 1320}, {"订单号": "34157775610", "金额": 1320}, {"订单号": "34089943994", "金额": 1320}, {"订单号": "34089929850", "金额": 1320}, {"订单号": "34043616314", "金额": 1320}, {"订单号": "33619208826", "金额": 1320}, {"订单号": "34249557370", "金额": 1320}, {"订单号": "34249308666", "金额": 1320}, {"订单号": "34249927418", "金额": 1320}, {"订单号": "28694724858", "金额": 1330}, {"订单号": "28699071994", "金额": 1340}, {"订单号": "28723879546", "金额": 1340}, {"订单号": "28946746938", "金额": 1398}, {"订单号": "34239502906", "金额": 1410}, {"订单号": "34180185594", "金额": 1410}, {"订单号": "34180304698", "金额": 1410}, {"订单号": "34180404858", "金额": 1410}, {"订单号": "34180620858", "金额": 1410}, {"订单号": "34157736762", "金额": 1410}, {"订单号": "33888238010", "金额": 1410}, {"订单号": "33511904314", "金额": 1410}, {"订单号": "34266473466", "金额": 1410}, {"订单号": "34265724666", "金额": 1410}, {"订单号": "34266004858", "金额": 1410}, {"订单号": "33108615034", "金额": 1420}, {"订单号": "33083978106", "金额": 1420}, {"订单号": "32954651002", "金额": 1420}, {"订单号": "32871232122", "金额": 1420}, {"订单号": "33635588730", "金额": 1420}, {"订单号": "33382461178", "金额": 1420}, {"订单号": "34204387898", "金额": 1430}, {"订单号": "34157625594", "金额": 1430}, {"订单号": "33619989882", "金额": 1430}, {"订单号": "33512054970", "金额": 1430}, {"订单号": "32684248762", "金额": 1440}, {"订单号": "28455725626", "金额": 1458}, {"订单号": "28954031354", "金额": 1470}, {"订单号": "28699026682", "金额": 1480}, {"订单号": "28977462970", "金额": 1498}, {"订单号": "28977803514", "金额": 1498}, {"订单号": "28976942842", "金额": 1498}, {"订单号": "34204823098", "金额": 1520}, {"订单号": "34204066682", "金额": 1520}, {"订单号": "34204547002", "金额": 1520}, {"订单号": "34204238202", "金额": 1520}, {"订单号": "34180473850", "金额": 1520}, {"订单号": "34157736890", "金额": 1520}, {"订单号": "34089923258", "金额": 1520}, {"订单号": "33887783738", "金额": 1520}, {"订单号": "33801161402", "金额": 1520}, {"订单号": "33756953658", "金额": 1520}, {"订单号": "33562598010", "金额": 1520}, {"订单号": "33392664570", "金额": 1520}, {"订单号": "34435724154", "金额": 1520}, {"订单号": "34429334330", "金额": 1520}, {"订单号": "34428623162", "金额": 1520}, {"订单号": "34429455802", "金额": 1520}, {"订单号": "34429414650", "金额": 1520}, {"订单号": "34429044474", "金额": 1520}, {"订单号": "34265761658", "金额": 1520}, {"订单号": "34249560442", "金额": 1520}, {"订单号": "34249183226", "金额": 1520}, {"订单号": "34249859578", "金额": 1520}, {"订单号": "33108533882", "金额": 1530}, {"订单号": "33212942650", "金额": 1530}, {"订单号": "32384055866", "金额": 1580}, {"订单号": "32384783546", "金额": 1580}, {"订单号": "32384094906", "金额": 1580}, {"订单号": "32384615098", "金额": 1580}, {"订单号": "31578805498", "金额": 1580}, {"订单号": "31517214330", "金额": 1580}, {"订单号": "31487078778", "金额": 1580}, {"订单号": "31487906490", "金额": 1580}, {"订单号": "29033549818", "金额": 1590}, {"订单号": "33033104826", "金额": 1614}, {"订单号": "32864219578", "金额": 1614}, {"订单号": "33020490746", "金额": 1628}, {"订单号": "34239838778", "金额": 1630}, {"订单号": "34180639738", "金额": 1630}, {"订单号": "34180564218", "金额": 1630}, {"订单号": "34180316858", "金额": 1630}, {"订单号": "34180452602", "金额": 1630}, {"订单号": "34083696058", "金额": 1630}, {"订单号": "33801576378", "金额": 1630}, {"订单号": "33757887034", "金额": 1630}, {"订单号": "33617859834", "金额": 1630}, {"订单号": "33533275450", "金额": 1630}, {"订单号": "33511811962", "金额": 1630}, {"订单号": "33404582586", "金额": 1630}, {"订单号": "33158280698", "金额": 1630}, {"订单号": "34435772538", "金额": 1630}, {"订单号": "34264770874", "金额": 1630}, {"订单号": "34268003834", "金额": 1630}, {"订单号": "34267550906", "金额": 1630}, {"订单号": "34267200250", "金额": 1630}, {"订单号": "28719752442", "金额": 1638}, {"订单号": "28719716666", "金额": 1638}, {"订单号": "28719666682", "金额": 1638}, {"订单号": "32938046714", "金额": 1640}, {"订单号": "32937605370", "金额": 1640}, {"订单号": "32883440442", "金额": 1640}, {"订单号": "32883414714", "金额": 1640}, {"订单号": "32883245882", "金额": 1640}, {"订单号": "32864563450", "金额": 1640}, {"订单号": "32864638330", "金额": 1640}, {"订单号": "33381740154", "金额": 1640}, {"订单号": "33263239738", "金额": 1640}, {"订单号": "32650487930", "金额": 1660}, {"订单号": "32537706874", "金额": 1660}, {"订单号": "32285889978", "金额": 1660}, {"订单号": "32269683514", "金额": 1660}, {"订单号": "32267595834", "金额": 1660}, {"订单号": "32114020282", "金额": 1660}, {"订单号": "32114323834", "金额": 1660}, {"订单号": "32692462010", "金额": 1660}, {"订单号": "29003141306", "金额": 1680}, {"订单号": "28723403066", "金额": 1730}, {"订单号": "34239536314", "金额": 1730}, {"订单号": "34204259002", "金额": 1730}, {"订单号": "33749952954", "金额": 1730}, {"订单号": "34456153402", "金额": 1730}, {"订单号": "34456510266", "金额": 1730}, {"订单号": "34429000570", "金额": 1730}, {"订单号": "34413735226", "金额": 1730}, {"订单号": "34267530874", "金额": 1730}, {"订单号": "29237529466", "金额": 1740}, {"订单号": "29237086522", "金额": 1740}, {"订单号": "29236811322", "金额": 1740}, {"订单号": "29047716858", "金额": 1740}, {"订单号": "29047745082", "金额": 1740}, {"订单号": "29047704442", "金额": 1740}, {"订单号": "33636430522", "金额": 1740}, {"订单号": "33263593914", "金额": 1740}, {"订单号": "29003288378", "金额": 1770}, {"订单号": "29002841402", "金额": 1770}, {"订单号": "29002836986", "金额": 1770}, {"订单号": "29002839162", "金额": 1770}, {"订单号": "28963036794", "金额": 1770}, {"订单号": "28963288442", "金额": 1770}, {"订单号": "28963292154", "金额": 1770}, {"订单号": "28962985402", "金额": 1770}, {"订单号": "28698878522", "金额": 1785}, {"订单号": "28699559674", "金额": 1791}, {"订单号": "28698933690", "金额": 1791}, {"订单号": "28699188538", "金额": 1800}, {"订单号": "28699104506", "金额": 1800}, {"订单号": "32864880570", "金额": 1810}, {"订单号": "31998354874", "金额": 1812}, {"订单号": "32455166330", "金额": 1824}, {"订单号": "32385005306", "金额": 1824}, {"订单号": "32673260922", "金额": 1826}, {"订单号": "32659014394", "金额": 1826}, {"订单号": "34181322746", "金额": 1830}, {"订单号": "33033158714", "金额": 1840}, {"订单号": "32883383034", "金额": 1840}, {"订单号": "33223645434", "金额": 1840}, {"订单号": "33215288954", "金额": 1840}, {"订单号": "33511899770", "金额": 1850}, {"订单号": "29035252218", "金额": 1860}, {"订单号": "28719881210", "金额": 1860}, {"订单号": "32650759162", "金额": 1860}, {"订单号": "32538143930", "金额": 1860}, {"订单号": "32205194874", "金额": 1860}, {"订单号": "33022926202", "金额": 1860}, {"订单号": "32772242170", "金额": 1860}, {"订单号": "32691979130", "金额": 1860}, {"订单号": "33223774010", "金额": 1860}, {"订单号": "33093897338", "金额": 1864}, {"订单号": "28976964410", "金额": 1870}, {"订单号": "28977282874", "金额": 1870}, {"订单号": "28976926202", "金额": 1870}, {"订单号": "28793667450", "金额": 1870}, {"订单号": "28699519226", "金额": 1995}, {"订单号": "28772276090", "金额": 2001}, {"订单号": "29033294714", "金额": 2067}, {"订单号": "33557740218", "金额": 2120}, {"订单号": "33532585210", "金额": 2120}, {"订单号": "33310667898", "金额": 2120}, {"订单号": "34462547514", "金额": 2120}, {"订单号": "33021848954", "金额": 2130}, {"订单号": "33999443578", "金额": 2130}, {"订单号": "33223299194", "金额": 2130}, {"订单号": "28988769786", "金额": 2160}, {"订单号": "32478123642", "金额": 2160}, {"订单号": "32478211514", "金额": 2160}, {"订单号": "32692405370", "金额": 2160}, {"订单号": "29003019322", "金额": 2240}, {"订单号": "28978176378", "金额": 2247}, {"订单号": "28963000186", "金额": 2247}, {"订单号": "28809045370", "金额": 2290}, {"订单号": "29008517050", "金额": 2320}, {"订单号": "28681250746", "金额": 2380}, {"订单号": "28992740410", "金额": 2400}, {"订单号": "28992560442", "金额": 2400}, {"订单号": "28991913082", "金额": 2400}, {"订单号": "27369639994", "金额": 2421}, {"订单号": "33080675706", "金额": 2428}, {"订单号": "31503347386", "金额": 2439}, {"订单号": "34239895738", "金额": 2450}, {"订单号": "33310885818", "金额": 2450}, {"订单号": "32454421370", "金额": 2458}, {"订单号": "32271718842", "金额": 2458}, {"订单号": "32675877946", "金额": 2460}, {"订单号": "32658831738", "金额": 2460}, {"订单号": "32538248186", "金额": 2460}, {"订单号": "33093242426", "金额": 2460}, {"订单号": "33032967162", "金额": 2460}, {"订单号": "32870420026", "金额": 2460}, {"订单号": "32856636282", "金额": 2460}, {"订单号": "32856866682", "金额": 2460}, {"订单号": "34225177402", "金额": 2460}, {"订单号": "34216563898", "金额": 2460}, {"订单号": "34070864506", "金额": 2460}, {"订单号": "32953733050", "金额": 2466}, {"订单号": "33801577146", "金额": 2470}, {"订单号": "33292690426", "金额": 2480}, {"订单号": "33108320314", "金额": 2480}, {"订单号": "32640728122", "金额": 2490}, {"订单号": "32641718010", "金额": 2490}, {"订单号": "32538129594", "金额": 2490}, {"订单号": "32537996090", "金额": 2490}, {"订单号": "32517376826", "金额": 2490}, {"订单号": "32485904378", "金额": 2490}, {"订单号": "32372336762", "金额": 2490}, {"订单号": "32363230714", "金额": 2490}, {"订单号": "32363656698", "金额": 2490}, {"订单号": "32692015546", "金额": 2490}, {"订单号": "28683301434", "金额": 2540}, {"订单号": "28683452730", "金额": 2540}, {"订单号": "28288419258", "金额": 2540}, {"订单号": "28288372858", "金额": 2540}, {"订单号": "28719616762", "金额": 2550}, {"订单号": "28771870522", "金额": 2589}, {"订单号": "29008449594", "金额": 2596}, {"订单号": "28694102906", "金额": 2624}, {"订单号": "28946559738", "金额": 2636}, {"订单号": "28946546106", "金额": 2636}, {"订单号": "28996576378", "金额": 2640}, {"订单号": "33800597178", "金额": 2650}, {"订单号": "33763662714", "金额": 2650}, {"订单号": "33392703738", "金额": 2650}, {"订单号": "33381367418", "金额": 2660}, {"订单号": "34575574906", "金额": 2732}, {"订单号": "32949003066", "金额": 2745}, {"订单号": "34327016634", "金额": 2750}, {"订单号": "32948814906", "金额": 2760}, {"订单号": "34225428346", "金额": 2760}, {"订单号": "34045787514", "金额": 2760}, {"订单号": "32385311866", "金额": 2790}, {"订单号": "32384843066", "金额": 2790}, {"订单号": "32372276922", "金额": 2790}, {"订单号": "32197043770", "金额": 2790}, {"订单号": "32196743162", "金额": 2790}, {"订单号": "32764076602", "金额": 2790}, {"订单号": "29056604730", "金额": 2820}, {"订单号": "34216003834", "金额": 2820}, {"订单号": "32870088058", "金额": 2840}, {"订单号": "34047075898", "金额": 2840}, {"订单号": "33223314298", "金额": 2840}, {"订单号": "28808866810", "金额": 2860}, {"订单号": "28808934906", "金额": 2860}, {"订单号": "33763535738", "金额": 2870}, {"订单号": "29003203962", "金额": 2880}, {"订单号": "28996574842", "金额": 2880}, {"订单号": "33381906490", "金额": 2880}, {"订单号": "33158035066", "金额": 2880}, {"订单号": "28699266682", "金额": 2975}, {"订单号": "28699079098", "金额": 2975}, {"订单号": "28699144762", "金额": 2975}, {"订单号": "28698870266", "金额": 2975}, {"订单号": "28698829562", "金额": 2975}, {"订单号": "28693672570", "金额": 2975}, {"订单号": "28693560762", "金额": 2975}, {"订单号": "28693776250", "金额": 2975}, {"订单号": "28693646714", "金额": 2975}, {"订单号": "28680930234", "金额": 2975}, {"订单号": "28681141562", "金额": 2975}, {"订单号": "28681222842", "金额": 2975}, {"订单号": "28681006586", "金额": 2975}, {"订单号": "28952603642", "金额": 2975}, {"订单号": "28693942906", "金额": 2985}, {"订单号": "28699144314", "金额": 3000}, {"订单号": "28698895098", "金额": 3000}, {"订单号": "33310589882", "金额": 3042}, {"订单号": "33763488570", "金额": 3050}, {"订单号": "33757806522", "金额": 3050}, {"订单号": "33533110138", "金额": 3050}, {"订单号": "34043466874", "金额": 3060}, {"订单号": "33093849914", "金额": 3069}, {"订单号": "33093613562", "金额": 3069}, {"订单号": "28476481402", "金额": 3125}, {"订单号": "28476401978", "金额": 3140}, {"订单号": "32543367610", "金额": 3160}, {"订单号": "28638951482", "金额": 3175}, {"订单号": "28638266298", "金额": 3175}, {"订单号": "28733392314", "金额": 3220}, {"订单号": "28709872890", "金额": 3228}, {"订单号": "34326979514", "金额": 3250}, {"订单号": "33032931834", "金额": 3280}, {"订单号": "32870690298", "金额": 3280}, {"订单号": "33636462650", "金额": 3280}, {"订单号": "33292260346", "金额": 3280}, {"订单号": "33223587258", "金额": 3280}, {"订单号": "32478406586", "金额": 3320}, {"订单号": "32205436090", "金额": 3320}, {"订单号": "32204999226", "金额": 3320}, {"订单号": "32764047802", "金额": 3320}, {"订单号": "32698272058", "金额": 3320}, {"订单号": "28699456186", "金额": 3325}, {"订单号": "28694514106", "金额": 3325}, {"订单号": "29039968186", "金额": 3445}, {"订单号": "34225468282", "金额": 3480}, {"订单号": "33223525754", "金额": 3480}, {"订单号": "34083532154", "金额": 3540}, {"订单号": "33083709370", "金额": 3550}, {"订单号": "33083447226", "金额": 3550}, {"订单号": "33021531834", "金额": 3550}, {"订单号": "32954476154", "金额": 3550}, {"订单号": "34084219706", "金额": 3550}, {"订单号": "28992931258", "金额": 3600}, {"订单号": "32948439482", "金额": 3642}, {"订单号": "28462468794", "金额": 3660}, {"订单号": "33747839354", "金额": 3670}, {"订单号": "28953757434", "金额": 3675}, {"订单号": "28953761018", "金额": 3675}, {"订单号": "32949384058", "金额": 3680}, {"订单号": "33293771194", "金额": 3680}, {"订单号": "32108418938", "金额": 3687}, {"订单号": "32108157370", "金额": 3687}, {"订单号": "33391752314", "金额": 3710}, {"订单号": "28465282682", "金额": 3720}, {"订单号": "28464739898", "金额": 3720}, {"订单号": "32692422906", "金额": 3720}, {"订单号": "34043594298", "金额": 3720}, {"订单号": "33263176058", "金额": 3720}, {"订单号": "29018248954", "金额": 3760}, {"订单号": "28709549306", "金额": 3768}, {"订单号": "28733029882", "金额": 3796}, {"订单号": "33108310778", "金额": 3990}, {"订单号": "33158156922", "金额": 3990}, {"订单号": "33764259066", "金额": 4090}, {"订单号": "28727868154", "金额": 4100}, {"订单号": "33083663610", "金额": 4100}, {"订单号": "33083858554", "金额": 4100}, {"订单号": "32954493946", "金额": 4100}, {"订单号": "32948887482", "金额": 4100}, {"订单号": "32937864442", "金额": 4100}, {"订单号": "34045770554", "金额": 4100}, {"订单号": "34017776442", "金额": 4100}, {"订单号": "33214870778", "金额": 4100}, {"订单号": "33158877306", "金额": 4100}, {"订单号": "32122635194", "金额": 4150}, {"订单号": "28712050554", "金额": 4215}, {"订单号": "33800962170", "金额": 4250}, {"订单号": "33391980154", "金额": 4250}, {"订单号": "34043512186", "金额": 4260}, {"订单号": "34043740026", "金额": 4260}, {"订单号": "28992716794", "金额": 4320}, {"订单号": "28988607610", "金额": 4320}, {"订单号": "33223256122", "金额": 4590}, {"订单号": "33158231290", "金额": 4590}, {"订单号": "32948295802", "金额": 4600}, {"订单号": "32938197498", "金额": 4600}, {"订单号": "31911787194", "金额": 4740}, {"订单号": "31872703098", "金额": 4740}, {"订单号": "33293297978", "金额": 4920}, {"订单号": "33263652602", "金额": 4920}, {"订单号": "33403405306", "金额": 4950}, {"订单号": "28465119162", "金额": 4960}, {"订单号": "33214788794", "金额": 4960}, {"订单号": "28499211578", "金额": 5000}, {"订单号": "29003011578", "金额": 5040}, {"订单号": "28791649338", "金额": 5154}, {"订单号": "28791259322", "金额": 5154}, {"订单号": "34046145274", "金额": 5220}, {"订单号": "33310706554", "金额": 5290}, {"订单号": "28675714234", "金额": 5300}, {"订单号": "33636082938", "金额": 5320}, {"订单号": "28462977466", "金额": 5436}, {"订单号": "28792053754", "金额": 5490}, {"订单号": "34083712506", "金额": 5510}, {"订单号": "29033548346", "金额": 5512}, {"订单号": "32954774586", "金额": 5520}, {"订单号": "33643882874", "金额": 5520}, {"订单号": "29035251834", "金额": 5580}, {"订单号": "29007760314", "金额": 5580}, {"订单号": "32692013434", "金额": 5580}, {"订单号": "28976713850", "金额": 5592}, {"订单号": "33263095802", "金额": 5680}, {"订单号": "33212850938", "金额": 5680}, {"订单号": "28680084538", "金额": 5759}, {"订单号": "29020737402", "金额": 5841}, {"订单号": "29020600442", "金额": 5841}, {"订单号": "28946566714", "金额": 5931}, {"订单号": "28946617146", "金额": 5931}, {"订单号": "33635480762", "金额": 6120}, {"订单号": "33666741754", "金额": 6190}, {"订单号": "33617955514", "金额": 6190}, {"订单号": "28465036474", "金额": 6200}, {"订单号": "28464796602", "金额": 6200}, {"订单号": "28464418426", "金额": 6200}, {"订单号": "28975970362", "金额": 6291}, {"订单号": "31468255674", "金额": 6320}, {"订单号": "31468178874", "金额": 6320}, {"订单号": "31432676986", "金额": 6320}, {"订单号": "31432266490", "金额": 6320}, {"订单号": "32384597882", "金额": 6320}, {"订单号": "32384091130", "金额": 6320}, {"订单号": "32384180026", "金额": 6320}, {"订单号": "32384583226", "金额": 6320}, {"订单号": "32954718650", "金额": 6440}, {"订单号": "28992246202", "金额": 6480}, {"订单号": "28988491002", "金额": 6480}, {"订单号": "28988619066", "金额": 6480}, {"订单号": "33393210170", "金额": 6546}, {"订单号": "34083491258", "金额": 6550}, {"订单号": "33748967994", "金额": 6550}, {"订单号": "28963294330", "金额": 6741}, {"订单号": "28976724602", "金额": 6920}, {"订单号": "33665770042", "金额": 7090}, {"订单号": "33619633274", "金额": 7090}, {"订单号": "33404228026", "金额": 7090}, {"订单号": "33292088506", "金额": 7100}, {"订单号": "33033006138", "金额": 7360}, {"订单号": "32938099258", "金额": 7360}, {"订单号": "32938209914", "金额": 7360}, {"订单号": "32938014330", "金额": 7360}, {"订单号": "34046189946", "金额": 7360}, {"订单号": "28465282618", "金额": 7440}, {"订单号": "32331955066", "金额": 7440}, {"订单号": "32692114042", "金额": 7440}, {"订单号": "32122931962", "金额": 7470}, {"订单号": "32122671994", "金额": 7470}, {"订单号": "32123162234", "金额": 7470}, {"订单号": "34607387770", "金额": 7620}, {"订单号": "34224584634", "金额": 7650}, {"订单号": "28791515514", "金额": 7731}, {"订单号": "28791156602", "金额": 7731}, {"订单号": "28975557818", "金额": 7785}, {"订单号": "31426254138", "金额": 7900}, {"订单号": "31426048698", "金额": 7900}, {"订单号": "31911732922", "金额": 7900}, {"订单号": "31872513786", "金额": 7900}, {"订单号": "27361635322", "金额": 8000}, {"订单号": "34280221946", "金额": 8150}, {"订单号": "34573106298", "金额": 8270}, {"订单号": "33084724282", "金额": 8280}, {"订单号": "33084585018", "金额": 8280}, {"订单号": "33084561722", "金额": 8280}, {"订单号": "33084873082", "金额": 8280}, {"订单号": "33032985530", "金额": 8280}, {"订单号": "32954744186", "金额": 8280}, {"订单号": "32948392570", "金额": 8280}, {"订单号": "32949255482", "金额": 8280}, {"订单号": "32949197882", "金额": 8280}, {"订单号": "32948387130", "金额": 8280}, {"订单号": "32948854906", "金额": 8280}, {"订单号": "32948362426", "金额": 8280}, {"订单号": "32938414266", "金额": 8280}, {"订单号": "32938079546", "金额": 8280}, {"订单号": "32938127482", "金额": 8280}, {"订单号": "32938045562", "金额": 8280}, {"订单号": "32883495994", "金额": 8280}, {"订单号": "32883563834", "金额": 8280}, {"订单号": "32883571450", "金额": 8280}, {"订单号": "32883497850", "金额": 8280}, {"订单号": "34045740474", "金额": 8280}, {"订单号": "34045613306", "金额": 8280}, {"订单号": "32331968954", "金额": 8370}, {"订单号": "32331831546", "金额": 8370}, {"订单号": "32331774330", "金额": 8370}, {"订单号": "32692113978", "金额": 8370}, {"订单号": "32692156474", "金额": 8370}, {"订单号": "32691841018", "金额": 8370}, {"订单号": "32691792314", "金额": 8370}, {"订单号": "32691667450", "金额": 8370}, {"订单号": "32691774586", "金额": 8370}, {"订单号": "34608911226", "金额": 8690}, {"订单号": "34281580922", "金额": 8700}, {"订单号": "28293927866", "金额": 10944}, {"订单号": "28462354362", "金额": 10980}, {"订单号": "28946057338", "金额": 11430}, {"订单号": "34281723130", "金额": 14710}, {"订单号": "33085096378", "金额": 14720}, {"订单号": "34608911290", "金额": 16550}, {"订单号": "33084491450", "金额": 16560}, {"订单号": "34279968762", "金额": 16560}];
let db = JSON.parse(localStorage.getItem("invoiceData_final")) || rawData.slice();
let deletedHistory = JSON.parse(localStorage.getItem("deletedHistory_final")) || [];
let lastCombo = [];

function findMatch() {
  const t = parseFloat(target.value), m = parseFloat(maxAmount.value) || Infinity;
  const s = document.getElementById("status"), ul = document.getElementById("comboList"), e = document.getElementById("exportText");
  ul.innerHTML = ""; e.value = ""; s.innerText = "计算中...";
  setTimeout(() => {
    const candidates = db.filter(x => x.金额 <= m).sort((a,b) => b.金额 - a.金额);
    let found = false; lastCombo = [];

    function bt(i,sum,cur) {
      if(sum === t){ lastCombo = cur.slice(); found = true; return; }
      if(sum > t || found || i >= candidates.length) return;
      for(let j = i; j < candidates.length; j++) {
        cur.push(candidates[j]);
        bt(j+1,sum+candidates[j].金额,cur);
        cur.pop();
      }
    }
    bt(0,0,[]);
    if(!found){ s.innerText = "未找到组合"; return; }
    s.innerText = "匹配成功，总金额：" + t;
    lastCombo.forEach(x => {
      let li = document.createElement("li");
      li.innerText = "订单号：" + x.订单号 + " 金额：" + x.金额;
      ul.appendChild(li);
    });

    let groups = [], cur = [], curSum = 0;
    for(let x of lastCombo) {
      if(curSum + x.金额 > m) {
        groups.push(cur); cur = []; curSum = 0;
      }
      cur.push(x); curSum += x.金额;
    }
    if(cur.length) groups.push(cur);

    let out = "";
    groups.forEach((group, i) => {
      const total = group.reduce((a,b)=>a + b.金额, 0);
      const multi = group.length > 1;
      out += `发票${i+1}: ${total}${multi ? "（相关订单合并）" : ""}\n`;
      group.forEach(x => {
        out += `订单号：${x.订单号} 金额：${x.金额}\n`;
      });
      out += "\n";
    });
    out += "不需要备注\n568881753@qq.com";
    e.value = out;
  }, 50);
}

function confirmDelete() {
  if(!lastCombo.length) return alert("请先查找组合");
  let ids = new Set(lastCombo.map(x => x.订单号));
  db = db.filter(x => !ids.has(x.订单号));
  deletedHistory.push(lastCombo);
  localStorage.setItem("invoiceData_final", JSON.stringify(db));
  localStorage.setItem("deletedHistory_final", JSON.stringify(deletedHistory));
  alert("已删除"); lastCombo = [];
  comboList.innerHTML = ""; status.innerText = ""; exportText.value = "";
  renderDeleted();
}

function resetDatabase() {
  if(confirm("确认重置？")) {
    db = rawData.slice(); deletedHistory = [];
    localStorage.setItem("invoiceData_final", JSON.stringify(db));
    localStorage.setItem("deletedHistory_final", JSON.stringify(deletedHistory));
    alert("已重置"); renderDeleted();
  }
}

function renderDeleted() {
  let c = document.getElementById("deletedRecords");
  c.innerHTML = ""; let r = deletedHistory.slice(-20);
  r.forEach((g,i) => {
    let div = document.createElement("div"); div.className = "record";
    let sum = g.reduce((s,x) => s + x.金额, 0);
    div.innerHTML = "<b>组合" + (i+1) + "（总金额：" + sum + "）</b><br>" + g.map(x => "订单号：" + x.订单号 + " 金额：" + x.金额).join("<br>");
    let b = document.createElement("button"); b.innerText = "恢复这组";
    b.onclick = () => {
      db = db.concat(g);
      deletedHistory.splice(deletedHistory.indexOf(g), 1);
      localStorage.setItem("invoiceData_final", JSON.stringify(db));
      localStorage.setItem("deletedHistory_final", JSON.stringify(deletedHistory));
      renderDeleted(); alert("已恢复");
    };
    div.appendChild(document.createElement("br")); div.appendChild(b); c.appendChild(div);
  });
}

function copyText() {
  let t = document.getElementById("exportText");
  t.select(); document.execCommand("copy"); alert("已复制");
}

window.onload = renderDeleted;
</script>
</body>
</html>